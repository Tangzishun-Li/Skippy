<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skippy</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- 导航栏 -->
  <nav class="navbar">
    <div class="navbar-brand">Skippy</div>
    <div class="navbar-nav">
      <button class="nav-btn active" data-view="calendar">日历视图</button>
      <button class="nav-btn" data-view="add-course">添加课程</button>
      <button class="nav-btn" data-view="course-list">课程列表</button>
      <button class="nav-btn" data-view="import">导入课程</button>
      <button class="nav-btn" id="export-ics">导出课程</button>
      <button class="nav-btn" id="toggle-timeline">DDL时间轴</button>
    </div>
  </nav>
  
  <div class="container">
    <!-- 日历视图 -->
    <div class="view" id="calendarView">
      <div class="calendar-header">
        <h2>课程日历</h2>
        <div class="calendar-controls">
          <button id="prevPeriod">⟪ 上月</button>
          <h3 id="currentPeriod"></h3>
          <button id="nextPeriod">下月 ⟫</button>
          <div class="view-toggle">
            <button class="view-btn active" data-view="month">月视图</button>
            <button class="view-btn" data-view="week">周视图</button>
          </div>
        </div>
      </div>
      <div id="calendar"></div>
    </div>
    
    <button id="fab-add" class="fab-button">
      <span class="fab-icon">+</span>
    </button>

    <div id="add-event-modal" class="glass-modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>✨ 新增日程</h3>
          <button class="close-btn" id="close-modal">×</button>
        </div>
        <div class="modal-body">
          <div class="input-group">
            <input type="text" id="event-name" required>
            <label>日程 / 课程名称</label>
            <div class="input-line"></div>
          </div>
          <div class="form-row">
            <div class="input-group">
              <input type="time" id="event-start" required>
              <label class="active">开始时间</label>
            </div>
            <div class="input-group">
              <input type="time" id="event-end" required>
              <label class="active">结束时间</label>
            </div>
          </div>
          <div class="type-selector">
            <label><input type="radio" name="event-type" value="normal" checked> 普通</label>
            <label class="type-ddl"><input type="radio" name="event-type" value="ddl"> ⚠️ DDL</label>
          </div>
          <button id="save-event-btn" class="glow-btn">保存日程</button>
        </div>
      </div>
    </div>

    <div id="ddl-timeline-panel" class="timeline-panel">
      <div class="timeline-header">
        <h3>🔥 死亡倒计时 (DDLs)</h3>
      </div>
      <div class="timeline-container" id="timeline-container">
      </div>
    </div>
    
    <div id="task-sidebar" class="task-sidebar hidden">
      <div class="sidebar-header">
        <h3 id="sidebar-title">课程详情</h3>
        <button id="close-sidebar">×</button>
      </div>
      <div class="sidebar-content" id="sidebar-tasks">
      </div>
    </div>
    
    <!-- 添加课程视图 -->
    <div class="view" id="addCourseView" style="display: none;">
      <h2>添加课程</h2>
      <form id="courseForm">
        <div class="form-group">
          <label for="courseName">课程名称：</label>
          <input type="text" id="courseName" required>
        </div>
        <div class="form-group">
          <label for="courseTime">上课时间：</label>
          <input type="time" id="courseStartTime" required>
          <span>至</span>
          <input type="time" id="courseEndTime" required>
        </div>
        <div class="form-group">
          <label for="courseDate">开课日期：</label>
          <input type="date" id="courseDate" required>
        </div>
        <div class="form-group">
          <label for="courseFrequency">频率：</label>
          <select id="courseFrequency" required>
            <option value="weekly">每周</option>
            <option value="biweekly">每两周</option>
            <option value="monthly">每个月</option>
            <option value="daily">每天</option>
          </select>
        </div>
        <div class="form-group">
          <label for="repeatCount">重复次数：</label>
          <input type="number" id="repeatCount" min="1" required>
        </div>
        <button type="submit">添加课程</button>
      </form>
    </div>
    
    <!-- 课程列表视图 -->
    <div class="view" id="courseListView" style="display: none;">
      <h2>课程列表</h2>
      <div class="help-guide">
        <div class="help-toggle">
          <span class="help-icon">?</span>
          <span>操作指引</span>
        </div>
        <div class="help-content">
          <div class="help-item">
            <span class="status-dot attended"></span>
            <span><strong>已上（无问题）</strong> - 点击课程标记为已上课</span>
          </div>
          <div class="help-item">
            <span class="status-dot skipped"></span>
            <span><strong>未上/旷课</strong> - 点击课程标记为缺勤</span>
          </div>
          <div class="help-item">
            <span class="status-dot problematic"></span>
            <span><strong>已上（有问题）</strong> - 点击后可添加问题备注</span>
          </div>
          <div class="help-item">
            <span class="status-dot ddl"></span>
            <span><strong>DDL</strong> - 为未来课程设置截止日期</span>
          </div>
        </div>
      </div>
      <div id="coursesContainer"></div>
    </div>
    
    <!-- 导入视图 -->
    <div class="view" id="importView" style="display: none;">
      <h2>导入课程</h2>
      <div class="import-tabs">
        <button class="import-tab active" data-tab="google">Google日历订阅</button>
        <button class="import-tab" data-tab="ics">ICS文件</button>
      </div>
      
      <!-- Google日历订阅 -->
      <div class="import-panel" id="googlePanel">
        <h3>从Google日历导入</h3>
        <p class="import-desc">输入Google日历的公开订阅链接或.ics地址</p>
        <form id="googleImportForm">
          <div class="form-group">
            <label for="googleCalendarUrl">日历链接：</label>
            <input type="url" id="googleCalendarUrl" placeholder="https://calendar.google.com/calendar/ical/..." required>
          </div>
          <button type="submit">导入</button>
        </form>
        <div id="googleImportResult"></div>
      </div>
      
      <!-- ICS文件上传 -->
      <div class="import-panel" id="icsPanel" style="display: none;">
        <h3>上传ICS文件</h3>
        <p class="import-desc">选择本地的.ics日历文件导入</p>
        <form id="icsImportForm">
          <div class="form-group">
            <label for="icsFile">选择文件：</label>
            <input type="file" id="icsFile" accept=".ics" required>
          </div>
          <button type="submit">导入</button>
        </form>
        <div id="icsImportResult"></div>
      </div>
    </div>
  </div>
  
  <!-- Toast 通知 -->
<div id="toast" class="toast">
  <span class="toast-icon">✓</span>
  <span class="toast-message" id="toastMessage">课程添加成功</span>
</div>

<!-- 时间轴标注弹窗 -->
<div class="modal" id="timelineModal">
  <div class="modal-content">
    <span class="close" id="timelineClose">&times;</span>
    <h3>添加时间轴标注</h3>
    <form id="timelineForm">
      <input type="hidden" id="timelineCourseId">
      <div class="form-group">
        <label>标注类型：</label>
        <select id="timelineType" required>
          <option value="before">第X周课程前</option>
          <option value="between">第X周与第Y周之间</option>
          <option value="after">第X周课程后</option>
        </select>
      </div>
      <div class="form-group" id="weekStartGroup">
        <label for="weekStart">开始周：</label>
        <input type="number" id="weekStart" min="1" required>
      </div>
      <div class="form-group" id="weekEndGroup" style="display:none;">
        <label for="weekEnd">结束周：</label>
        <input type="number" id="weekEnd" min="1" required>
      </div>
      <div class="form-group" id="weekSingleGroup">
        <label for="weekSingle">指定周：</label>
        <input type="number" id="weekSingle" min="1" required>
      </div>
      <div class="form-group">
        <label for="timelineLabel">标注名称（可选）：</label>
        <input type="text" id="timelineLabel" placeholder="如：期末考试、项目截止">
      </div>
      <button type="submit">添加标注</button>
    </form>
    <div id="timelineList"></div>
  </div>
</div>

<!-- 问题记录弹窗 -->
<div class="modal" id="problemModal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>记录问题</h3>
      <form id="problemForm">
        <input type="hidden" id="courseId">
        <input type="hidden" id="lessonIndex">
        <div class="form-group">
          <label for="problemDescription">问题描述：</label>
          <textarea id="problemDescription" rows="4" required></textarea>
        </div>
        <button type="submit">保存问题</button>
      </form>
    </div>
  </div>
  
  <!-- 问题悬停浮窗 -->
  <div class="tooltip" id="problemTooltip">
    <div class="tooltip-content">
      <span class="tooltip-close">&times;</span>
      <h4>课程问题</h4>
      <div class="tooltip-body" id="tooltipBody"></div>
      <button class="tooltip-edit" id="editProblem">+</button>
    </div>
  </div>
  
  <script src="js/utils/dateUtils.js"></script>
  <script src="js/utils/storage.js"></script>
  <script src="js/components/toast.js"></script>
  <script src="js/components/modal.js"></script>
  <script src="js/core/import.js"></script>
  <script src="js/core/problem.js"></script>
  <script src="js/core/status.js"></script>
  <script src="js/core/timeline.js"></script>
  <script src="js/core/calendar.js"></script>
  <script src="js/core/course.js"></script>
  <script src="js/main.js"></script>
</body>
</html>