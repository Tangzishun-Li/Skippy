<!-- 悬浮球文件 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skippy 悬浮球</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: transparent;
      user-select: none;
    }
    
    #app {
      width: 80px;
      height: 30px;
      overflow: hidden;
    }
    
    .warp {
      width: 80px;
      height: 30px;
      overflow: hidden;
    }
    
    .main-container {
      width: 80px;
      height: 30px;
      background: linear-gradient(135deg, #5e72e4, #825ee4);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      cursor: move;
      transition: all 0.3s ease;
      color: white;
      opacity: 0.8;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .text {
      z-index: 1;
    }
    
    .finish {
      position: absolute;
      width: 80px;
      height: 100%;
      background: linear-gradient(135deg, #2dce89, #11cdef);
      right: 0;
      transition: right 0.3s ease;
    }
    
    .main-container:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(94, 114, 228, 0.6);
    }
    
    .son-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 80px;
      height: 30px;
      font-size: 12px;
    }
    
    .son-item {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(135deg, #5e72e4, #825ee4);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .son-item:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(94, 114, 228, 0.6);
    }
    
    .son-item img {
      width: 12px;
      height: 12px;
      pointer-events: none;
    }
    
    .fade-enter-active,
    .fade-leave-active {
      transition: opacity 0.2s ease;
    }
    
    .fade-enter,
    .fade-leave-to {
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="warp" id="warp" onmousedown="handleMouseDown(event)" onmouseup="handleMouseUp(event)" onmouseenter="showMore()" onmouseleave="hideMore()">
      <div id="mainContainer" class="main-container">
        <div class="text" id="ballText">Skippy</div>
        <div class="finish" id="progressBar"></div>
      </div>
      <div id="sonContainer" class="son-container" style="display: none;">
        <div class="son-item" onclick="toggleMainWindow()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
          </svg>
        </div>
        <div class="son-item" onclick="showCalendar()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div class="son-item" onclick="showAddCourse()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let isDragging = false;
    let biasX = 0;
    let biasY = 0;
    const moveS = [0, 0, 0, 0];
    let mainColor = '#5e72e4';
    let subColor = '#825ee4';
    let opacity = 0.8;
    
    // 计算是否为点击（不是拖动）
    function calcS() {
      const res = Math.pow(moveS[0] - moveS[2], 2) + Math.pow(moveS[1] - moveS[3], 2);
      return res < 5;
    }
    
    // 处理鼠标按下事件
    function handleMouseDown(e) {
      if (e.button === 2) {
        // 右键点击，显示菜单
        window.electronAPI.openMenu();
        return;
      }
      
      isDragging = true;
      biasX = e.clientX;
      biasY = e.clientY;
      moveS[0] = e.screenX - biasX;
      moveS[1] = e.screenY - biasY;
      
      // 开始监听鼠标移动
      document.addEventListener('mousemove', handleMouseMove);
    }
    
    // 处理鼠标移动事件
    function handleMouseMove(e) {
      if (isDragging) {
        window.electronAPI.ballWindowMove({ x: e.screenX - biasX, y: e.screenY - biasY });
      }
    }
    
    // 处理鼠标释放事件
    function handleMouseUp(e) {
      moveS[2] = e.screenX - e.clientX;
      moveS[3] = e.screenY - e.clientY;
      isDragging = false;
      biasX = 0;
      biasY = 0;
      
      // 移除鼠标移动监听
      document.removeEventListener('mousemove', handleMouseMove);
    }
    
    // 显示更多功能
    function showMore() {
      document.getElementById('mainContainer').style.display = 'none';
      document.getElementById('sonContainer').style.display = 'flex';
    }
    
    // 隐藏更多功能
    function hideMore() {
      document.getElementById('mainContainer').style.display = 'flex';
      document.getElementById('sonContainer').style.display = 'none';
    }
    
    // 切换主窗口显示/隐藏
    function toggleMainWindow() {
      if (calcS()) {
        window.electronAPI.toggleMainWindow();
      }
    }
    
    // 显示日历视图
    function showCalendar() {
      if (calcS()) {
        window.electronAPI.showCalendar();
      }
    }
    
    // 显示添加课程视图
    function showAddCourse() {
      if (calcS()) {
        window.electronAPI.showAddCourse();
      }
    }
    
    // 更新悬浮球数据
    function updateBallData(data) {
      if (data && Array.isArray(data)) {
        const [total, completed] = data;
        document.getElementById('ballText').textContent = `${completed} : ${total}`;
        
        // 更新进度条
        if (total > 0) {
          const percent = Math.round((completed / total) * 100);
          document.getElementById('progressBar').style.right = `${100 - percent}%`;
        } else {
          document.getElementById('progressBar').style.right = '100%';
        }
      }
    }
    
    // 更新配置
    function updateConfig(config) {
      if (config) {
        if (config.opacity !== undefined) {
          opacity = config.opacity;
          document.getElementById('mainContainer').style.opacity = opacity;
        }
        if (config.mainColor) {
          mainColor = config.mainColor;
        }
        if (config.subColor) {
          subColor = config.subColor;
        }
      }
    }
    
    // 监听数据更新
    window.electronAPI.onUpdate(updateBallData);
    
    // 监听配置更新
    window.electronAPI.onConfig(updateConfig);
    
    // 请求初始数据
    window.electronAPI.updateBall();
  </script>
</body>
</html>