# 课程管理增强功能规格说明书

## 变更概述

本次变更为课程管理系统的核心增强，涵盖问题备注、时间语义化、导入导出等关键功能。

## 现有系统分析

当前系统状态：
- 课程状态：默认(无标签)、已上且无问题(绿色)、未上/旷课(红色)、已上但有问题(黄色)、未来课程(蓝色/DDL)
- 课程属性：名称、时间、日期、频率、重复次数
- 悬浮球功能：暂不修改

## 本次修改内容

### 1. 问题备注功能
- 为标记为"已上但有问题"的课程添加备注功能
- 备注内容：记录具体问题、改进建议等
- 备注存储：持久化到本地存储

### 2. 日期语义化调整
- "上课日期"字段名称改为"开课日期"
- 保持现有功能不变

### 3. 日历界面优化
- 借鉴现代化日历UI设计
- 采用清新、简洁的设计风格
- 支持月份导航和课程状态可视化
- 参考设计方向：浅色主题、圆角卡片、柔和阴影、周视图/月视图切换

### 4. 法定节假日自动跳过
- 排课时自动识别并跳过法定节假日
- 节假日数据源：使用 `holiday-cn` 开源项目数据 (https://github.com/holiday-cn)
- 需更新时从 GitHub RAW URL 获取最新节假日数据

### 5. 添加成功提示
- 课程添加完成后显示成功提示
- 提示方式：轻量级 toast 通知，2-3秒后自动消失

### 6. 课程列表操作指引
- 在课程列表区域添加操作说明
- 说明内容：如何标记状态、如何添加备注等
- 设计：icon + 简短文字，悬停可展开详细说明

### 7. 时间轴式 DDL 标注系统
- 将简单的 DDL 标签改为时间轴标注
- 支持以下标注方式：
  - "第X周课程前"
  - "第X周与第Y周课程之间"
  - "第X周课程后"
- 可在时间轴上标注多个关键节点

### 8. Google 日历订阅导入
- 支持通过 Google 日历公开订阅链接导入课程
- 导入方式：输入 Google 日历的 .ics 链接或嵌入 URL
- 支持的 URL 格式：
  - `https://calendar.google.com/calendar/ical/{calendar_id}/public/basic.ics`
  - `https://calendar.google.com/calendar/embed?src={calendar_id}`
- 解析导入的events并转换为本地课程格式

### 9. ICS 文件导入
- 支持直接上传 .ics 文件导入课程
- 解析标准 iCalendar 格式 (RFC 5545)
- 提取关键字段：DTSTART、DTEND、SUMMARY、DESCRIPTION、RRULE
- 支持重复规则 (RRULE) 的解析

## 影响范围

### 受影响的规格
- 课程管理功能
- 日历视图功能
- 课程状态标记功能

### 受影响的代码模块
- `src/renderer/js/script.js` - 前端逻辑
- `src/renderer/index.html` - 主页面结构
- `src/renderer/css/style.css` - 样式文件
- `src/main/modules/ipcHandlers.js` - IPC 通信处理

## 功能需求详细说明

### Requirement: 问题课程备注功能
系统 SHALL 提供为标记为"已上但有问题"的课程添加备注的功能。

#### Scenario: 添加备注
- **GIVEN** 用户已标记某课程状态为"已上但有问题"
- **WHEN** 用户点击备注图标或备注按钮
- **THEN** 显示备注输入框，用户可输入文字内容
- **AND** 备注内容自动保存到本地存储

#### Scenario: 查看备注
- **GIVEN** 课程已有备注内容
- **WHEN** 用户将鼠标悬停在该课程上
- **THEN** 显示已保存的备注内容

### Requirement: 开课日期
系统 SHALL 使用"开课日期"替代原有的"上课日期"字段名称。

#### Scenario: 字段显示
- **WHEN** 用户打开添加/编辑课程界面
- **THEN** 日期相关字段显示为"开课日期"

### Requirement: 法定节假日自动跳过
系统 SHALL 在排课时自动跳过法定节假日。

#### Scenario: 节假日检测
- **GIVEN** 用户设置了课程的开始日期和重复周期
- **WHEN** 系统生成课程安排时
- **THEN** 自动跳过所有法定节假日的日期

### Requirement: 添加成功提示
系统 SHALL 在课程添加成功后显示提示信息。

#### Scenario: 显示提示
- **WHEN** 用户成功添加课程
- **THEN** 显示"课程添加成功"的 toast 提示，2-3秒后自动消失

### Requirement: 操作指引
系统 SHALL 在课程列表区域显示操作指引。

#### Scenario: 显示指引
- **WHEN** 用户打开课程列表页面
- **THEN** 显示简短的操作指引图标或文字

### Requirement: 时间轴 DDL 标注
系统 SHALL 支持在课程时间轴上标注关键节点。

#### Scenario: 添加时间轴标注
- **GIVEN** 用户选择了某门课程
- **WHEN** 用户选择"添加时间轴标注"
- **THEN** 用户可选择：第X周课程前 / 第X周与第Y周之间 / 第X周课程后
- **AND** 标注显示在日历视图中

### Requirement: Google日历订阅导入
系统 SHALL 支持通过Google日历公开订阅链接导入课程。

#### Scenario: 导入Google日历
- **WHEN** 用户选择"从Google日历导入"
- **AND** 用户输入有效的Google日历公开链接或.ics地址
- **THEN** 系统解析链接获取日历事件
- **AND** 将事件转换为本地课程格式

### Requirement: ICS文件导入
系统 SHALL 支持上传.ics文件导入课程。

#### Scenario: 上传ICS文件
- **WHEN** 用户选择"导入ICS文件"
- **AND** 用户选择本地.ics文件上传
- **THEN** 系统解析ICS文件内容
- **AND** 将事件转换为本地课程格式
