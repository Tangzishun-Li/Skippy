# 逃课记录软件 - 项目结构说明

本文档详细描述了逃课记录软件的项目结构，包括每个文件的功能、包含的函数和变量等。

## 项目文件结构

```
逃课记录软件/
├── index.html          # 主页面结构
├── main.js             # Electron主进程
├── preload.js          # 预加载脚本
├── script.js           # 前端逻辑
├── style.css           # 样式文件
├── package.json        # 项目配置
├── vite.config.js      # Vite配置
├── README.md           # 项目说明
└── 项目结构说明.md     # 本文档
```

## 文件详细说明

### 1. index.html - 主页面结构

**功能**：定义应用的HTML结构，包括导航栏、日历视图、添加课程表单和课程列表等。

**主要结构**：
- `<nav class="navbar">` - 顶部导航栏，包含视图切换按钮
- `<div id="calendarView">` - 日历视图容器
- `<div id="addCourseView">` - 添加课程表单容器
- `<div id="courseListView">` - 课程列表容器
- `<div id="problemModal">` - 问题记录弹窗
- `<div id="problemTooltip">` - 问题悬停浮窗

**重要元素**：
- `#courseForm` - 课程添加表单
- `#coursesContainer` - 课程列表容器
- `#calendar` - 日历容器

### 2. main.js - Electron主进程

**功能**：Electron应用的主入口，负责创建和管理应用窗口。

**主要功能**：
- 创建应用窗口
- 加载HTML文件
- 处理应用生命周期事件

**核心代码**：
```javascript
const { app, BrowserWindow } = require('electron')
const path = require('path')

function createWindow() {
  // 创建应用窗口
  const mainWindow = new BrowserWindow({
    width: 800,
    height: 600,
    autoHideMenuBar: true,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: true,
      contextIsolation: false
    }
  })
  
  // 加载HTML文件
  mainWindow.loadFile('index.html')
  mainWindow.webContents.openDevTools()
}

// 应用启动时创建窗口
app.whenReady().then(createWindow)

// 处理应用关闭事件
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') app.quit()
})
```

### 3. preload.js - 预加载脚本

**功能**：Electron的预加载脚本，在渲染进程加载前执行，用于设置渲染进程的环境。

**主要功能**：
- 替换页面中的版本信息

**核心代码**：
```javascript
window.addEventListener('DOMContentLoaded', () => {
  const replaceText = (selector, text) => {
    const element = document.getElementById(selector)
    if (element) element.innerText = text
  }

  for (const dependency of ['chrome', 'node', 'electron']) {
    replaceText(`${dependency}-version`, process.versions[dependency])
  }
})
```

### 4. script.js - 前端逻辑

**功能**：应用的核心逻辑，包括课程管理、状态管理、日历渲染等。

**全局变量**：
- `courses` - 课程列表
- `currentDate` - 当前显示的日历日期
- `problemTooltip` - 问题悬停浮窗元素
- `currentTooltipCourseId` - 当前悬停的课程ID
- `currentTooltipLessonIndex` - 当前悬停的课程索引

**核心函数**：

#### 初始化和数据管理
- `initApp()` - 初始化应用，加载数据并渲染界面
- `loadCourses()` - 从本地存储加载课程数据
- `saveCourses()` - 保存课程数据到本地存储

#### 课程管理
- `addCourse(e)` - 添加新课程
- `deleteCourse(courseId)` - 删除课程
- `updateLessonStatus(courseId, lessonIndex, status)` - 更新课程状态

#### 界面渲染
- `renderCourses()` - 渲染课程列表
- `renderCalendar()` - 渲染日历
- `getCoursesForDate(date)` - 获取指定日期的课程

#### 交互处理
- `addLessonClickListeners()` - 为课程项添加点击事件
- `showStatusMenu(e, courseId, lessonIndex)` - 显示状态切换菜单
- `showProblemModal(courseId, lessonIndex)` - 显示问题记录弹窗
- `saveProblem(e)` - 保存问题记录

#### 辅助函数
- `getFrequencyText(frequency)` - 获取频率的中文文本
- `switchView(view)` - 切换视图

### 5. style.css - 样式文件

**功能**：定义应用的CSS样式，包括布局、颜色、动画等。

**主要样式**：
- `.navbar` - 导航栏样式
- `.calendar-day` - 日历单元格样式
- `.lesson-item` - 课程项样式
- `.tooltip` - 悬停浮窗样式
- `.course-item` - 课程项样式

**状态样式**：
- `.lesson-future` - 未来课程（灰色）
- `.lesson-attended` - 已上课程（绿色）
- `.lesson-skipped` - 旷课（红色）
- `.lesson-problematic` - 有问题（黄色）
- `.lesson-ddl` - DDL（蓝色）

### 6. package.json - 项目配置

**功能**：定义项目的基本信息、依赖和脚本。

**主要配置**：
- `name` - 项目名称："逃课记录软件"
- `scripts` - 脚本命令：
  - `dev` - 启动Vite开发服务器
  - `build` - 构建项目
  - `electron` - 运行Electron应用
  - `electron:dev` - 开发模式运行Electron
- `devDependencies` - 开发依赖：
  - `electron` - Electron框架
  - `vite` - 构建工具
  - `concurrently` - 并行运行命令
  - `wait-on` - 等待服务启动

### 7. vite.config.js - Vite配置

**功能**：配置Vite构建工具的行为。

**主要配置**：
- `server.port` - 开发服务器端口：5173

## 核心功能说明

### 1. 课程管理

**添加课程**：
- 输入课程名称、时间、日期、频率和重复次数
- 系统根据设置生成课程的每一节课

**删除课程**：
- 课程列表中每个课程项都有删除按钮
- 点击删除按钮会显示确认对话框
- 确认后删除课程并更新界面

### 2. 状态管理

**课程状态**：
- `future` - 未来课程（灰色）
- `attended` - 已上且无问题（绿色）
- `skipped` - 未上/旷课（红色）
- `problematic` - 已上但有问题（黄色）
- `ddl` - 截止日期（蓝色，仅未来课程）

**状态限制**：
- 未来课程：只能设置为`future`或`ddl`
- 过去课程：只能设置为`attended`、`skipped`或`problematic`

### 3. 日历功能

**日历显示**：
- 月历视图，显示每天的课程
- 当天日期突出显示
- 不同状态的课程用不同颜色标记

**日历导航**：
- 支持切换上月、下月
- 显示当前月份和年份

### 4. 问题记录

**问题标记**：
- 课程状态设置为`problematic`时，显示为黄色
- 鼠标悬停时显示问题记录浮窗
- 浮窗左上角有编辑按钮

**问题编辑**：
- 点击编辑按钮打开问题记录弹窗
- 可以添加或修改问题描述
- 保存后更新课程状态和显示

## 技术实现要点

1. **数据存储**：使用`localStorage`存储课程数据，确保数据持久化
2. **日历计算**：根据课程的开始日期和频率计算每节课的实际日期
3. **状态管理**：基于课程日期判断状态限制，确保状态设置的合理性
4. **交互体验**：添加悬停效果、动画过渡和确认对话框，提升用户体验
5. **响应式设计**：适配不同屏幕尺寸，确保在各种设备上正常显示

## 总结

逃课记录软件是一个功能完整的Electron应用，通过合理的文件结构和清晰的代码组织，实现了课程管理、状态跟踪、日历显示和问题记录等核心功能。本文档详细描述了项目的文件结构和功能实现，希望能帮助开发者更好地理解和维护代码。